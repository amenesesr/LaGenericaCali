<nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute sticky-top">
  <img src="/cali/assets/img/header.png" class="img-fluid" alt="Tienda La Generica - Cali">
</nav>

<div class="content">

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <br>
          <%notificaciones.forEach((notificacion) => {
            if (notificacion.error_notificaciones == 9)
            {%>
              <br>
              <div class="alert alert-success d-flex align-items-center" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                <div>
                  La tabla de <b>Clientes Rechazados Por Presentar Errores</b> se ha limpiado con exito.
                </div>
              </div>
            <%}
          })%>   
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-success">
            <h4 class="card-title"><b>Ingresar clientes con un archivo CSV</b></h4>
            <p class="card-category">Seleccione un archivo CSV para crear los clientes</p>
          </div>

          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12">
                <br>
                  <%notificaciones.forEach((notificacion) => {
                    if (notificacion.error_notificaciones == 3)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Todos los <b>Clientes</b> fueron <b>Rechazados</b> para ser grabados porque ya tienen la cedula registrada en la base de datos.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Clientes Aceptados: <%= cargue.aceptados_cargues %>
                            <br>Clientes Rechazados: <b><%= cargue.rechazados_cargues %></b>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <%})%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="rechazados" href="#tablaClientesRechazados"><b>Clientes Rechazados Por Presentar Errores</b></a> al final de la página.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 4)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          Algunos <b>Clientes</b> fueron <b>Rechazados</b> para ser grabados porque ya tienen la cedula registrada en la base de datos.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Clientes Aceptados: <b><%= cargue.aceptados_cargues %></b>
                            <br>Clientes Rechazados: <b><%= cargue.rechazados_cargues %></b>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <% })%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="rechazados" href="#tablaClientesRechazados"><b>Clientes Rechazados Por Presentar Errores</b></a> al final de la página.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 5)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div> 
                          Todos los <b>Clientes</b> fueron <b>Aceptados</b> con éxito.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Clientes Aceptados: <b><%= cargue.aceptados_cargues %></b>
                            <br>Clientes Rechazados: <%= cargue.rechazados_cargues %>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <%})%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="aceptados" href="#tablaClientes"><b>Clientes Grabados en la Base de Datos</b></a>.
                        </div>
                      </div>
                    <%}
                  })%>   
              </div>
            </div>
          </div>

          <div class="card-body">
            <form method="POST" action="/cali/clientes/cargar/" enctype="multipart/form-data">
              <div class="row">
                <div class="col-md-12">
                  <div>
                    <input class="form-control-lg" id="archivo" type="file" name="archivo" accept=".csv" onchange="return validarExt()" required/> 
                  </div>
                </div>
              </div>   
              <button type="submit" class="btn btn-success pull-right">Subir Archivo</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- End Navbar -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-success">
            <h4 class="card-title"><b>Ingresar clientes de forma individual</b></h4>
            <p class="card-category">Complete la información del cliente</p>
          </div>

          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12">
                <br>
                <%notificaciones.forEach((notificacion) => {
                  if (notificacion.error_notificaciones == 1)
                  {%>
                    <br>
                    <div class="alert alert-danger d-flex align-items-center" role="alert">
                      <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                      <div>
                        No se puede crear el Cliente porque la <b>Cedula</b> ya esta registrada en la base de datos, para más información ver la tabla de <a class="rechazados" href="#tablaClientesRechazados"><b>Clientes Rechazados Por Presentar Error</b></a> al final de la página.
                      </div>
                    </div>
                  <%}
                  if (notificacion.error_notificaciones == 2)
                  {%>
                    <br>
                    <div class="alert alert-success d-flex align-items-center" role="alert">
                      <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                      <div>
                        Cliente creado con éxito.
                      </div>
                    </div>
                  <%}
                })%>
              </div>
            </div>
          </div>
  
          <div class="card-body">
            <form action="/cali/clientes/crear/" method="POST">
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Cedula</label>
                    <input type="number" class="form-control bg-transparent text-white border-0" name="txtCedula" id="txtCedula" maxlength="50" min="1" pattern="[0-9]+" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Nombre</label>
                    <input type="text" class="form-control bg-transparent text-white border-0" name="txtNombre" id="txtNombre" maxlength="50" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Telefono</label>
                    <input type="number" class="form-control bg-transparent text-white border-0" name="txtTelefono" id="txtTelefono" maxlength="50" min="0" pattern="[0-9]+" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Correo Electronico</label>
                    <input type="email" class="form-control bg-transparent text-white border-0" name="txtCorreo" id="txtCorreo" maxlength="50" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Direccion</label>
                    <input type="text" class="form-control bg-transparent text-white border-0" name="txtDireccion" id="txtDireccion" maxlength="50" required>
                  </div>
                </div>
              </div>
              
              <button type="submit" class="btn btn-success pull-right">Crear cliente</button>
            </form>
          </div>

        </div>
      </div>
    </div>
  </div>

  <%if (clientes.length != 0)
  {%>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header card-header-success">
              <h4 class="card-title"><b>Clientes registrados en la base de datos</b></h4>
            </div>

            <div class="container-fluid">
              <div class="row">
                <div class="col-md-12">
                  <%notificaciones.forEach((notificacion) => {
                    if (notificacion.error_notificaciones == 6)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          Cliente modificado con éxito.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 7)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          No se puede eliminar el Cliente porque ya tiene ventas registradas.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 8)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Usuario eliminado con éxito.
                        </div>
                      </div>
                    <%}
                  })%>
                </div>
              </div>
            </div>


            <div class="card-body">
              <div class="table-responsive">
                <table class="table mdl-data-table" id="tablaClientes" style="text-align: center; width:100%;">
                  <thead class=" text-success">
                    <th>
                      Cedula
                    </th>
                    <th>
                      Nombre
                    </th>
                    <th>
                      Telefono
                    </th>
                    <th>
                      Correo Electronico
                    </th>
                    <th>
                      Direccion
                    </th>
                    <th>
                      Acciones
                    </th>
                  </thead>
                  <tbody>
                    <%clientes.forEach((cliente) => {%>
                      <tr>
                        <td class="text-primary"><%=cliente.cedula_clientes%></td>
                        <td><%=cliente.nombre_clientes%></td>
                        <td><%=cliente.telefono_clientes%></td>
                        <td><%=cliente.email_clientes%></td>
                        <td><%=cliente.direccion_clientes%></td>
                        <td>
                          <button type="button" class="btn btnEditarCliente " data-bs-toggle="modal" data-bs-target="#modalCliente">
                            EDITAR
                          </button>
                          <button type="submit" class="btn" onclick="confirmarCliente(<%=cliente.cedula_clientes%>)"><i class="material-icons">delete_forever</i></button> 
                        </td>
                      </tr>
                    <%})%>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <%}%>

 <%if (clientesRechazados.length != 0)
  {%>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header card-header-success">
              <h4 class="card-title"><b>Clientes rechazados por presentar errores</b></h4>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table mdl-data-table" id="tablaClientesRechazados" style="text-align: center; width:100%;">
                  <thead class=" text-success">
                    <th>
                      Cedula
                    </th>
                    <th>
                      Nombre
                    </th>
                    <th>
                      Error
                    </th>
                    <th>
                      Fecha
                    </th>
                  </thead>
                  <tbody>
                    <%clientesRechazados.forEach((clienteRechazado) => {%>
                      <tr>
                        <td class="text-primary"><%=clienteRechazado.cedula_clientes_rechazados%></td>
                        <td><%=clienteRechazado.nombre_clientes_rechazados%></td>
                        <td class="text-warning"><%=clienteRechazado.error_clientes_rechazados%></td>
                        <td><%=clienteRechazado.fecha_clientes_rechazados%></td>
                      </tr>
                    <%})%>
                  </tbody>
                  <tr> 
                    <td colspan="4">
                      <a href='/cali/clientes/limpiar' class="w-100 btn btn-success pull-right"> Limpiar Datos</a>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <%}%>
      
  <div id="modalCliente" class="modal fade" tabindex="-1" aria-labelledby="modalCliente" aria-hiden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="exampleModalLabel">Editar Cliente</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="form" action="/cali/clientes/modificar/" method="POST">
          <div class="modal-body">
            <input type="number" name="txtCedula_editar" id="txtCedula_editar" hidden>
            <div class="mb-3">
              <label class="form-label" for="txtNombre_editar">Nombre Completo </label>
              <input class="form-control bg-transparent text-black border-0" type="text" name="txtNombre_editar" id="txtNombre_editar" maxlength="50" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label" for="txtTelefono_editar">Teléfono</label> 
              <input class="form-control bg-transparent text-black border-0" type="number" name="txtTelefono_editar" id="txtTelefono_editar" maxlength="20" min="1" pattern="[0-9]+" required>
            </div>
            
            <div class="mb-3">
              <label class="form-label" for="txtCorreo_editar">Correo Electrónico </label>
              <input class="form-control bg-transparent text-black border-0" type="email" name="txtCorreo_editar" id="txtCorreo_editar"	maxlength="50" required>
            </div>
  
            <div class="mb-3">
              <label class="form-label" for="txtDireccion">Dirección </label>
              <input class="form-control bg-transparent text-black border-0" type="text" name="txtDireccion_editar" id="txtDireccion_editar" maxlength="50" required>
            </div> 
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Modificar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
      