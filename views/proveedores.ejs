<nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute sticky-top">
  <img src="/cali/assets/img/header.png" class="img-fluid" alt="Tienda La Generica - Cali">
</nav>

<div class="content">

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <br>
          <%notificaciones.forEach((notificacion) => {
            if (notificacion.error_notificaciones == 9)
            {%>
              <br>
              <div class="alert alert-success d-flex align-items-center" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                <div>
                  La tabla de <b>Proveedores Rechazados Por Presentar Errores</b> se ha limpiado con exito.
                </div>
              </div>
            <%}
          })%>   
      </div>
    </div>
  </div>


  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-success">
            <h4 class="card-title"><b>Ingresar proveedores con un archivo CSV</b></h4>
            <p class="card-category">Seleccione un archivo CSV para crear los proveedores</p>
          </div>

          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12">
                <br>
                  <%notificaciones.forEach((notificacion) => {
                    if (notificacion.error_notificaciones == 3)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Todos los <b>Proveedores</b> fueron <b>Rechazados</b> para ser grabados porque ya tienen el NIT registrado en la base de datos.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Proveedores Aceptados: <%= cargue.aceptados_cargues %>
                            <br>Proveedores Rechazados: <b><%= cargue.rechazados_cargues %></b>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <%})%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="rechazados" href="#tablaProveedoresRechazados"><b>Proveedores Rechazados Por Presentar Errores</b></a> al final de la página.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 4)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          Algunos <b>Proveedores</b> fueron <b>Rechazados</b> para ser grabados porque ya tienen el NIT registrado en la base de datos.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Proveedores Aceptados: <b><%= cargue.aceptados_cargues %></b>
                            <br>Proveedores Rechazados: <b><%= cargue.rechazados_cargues %></b>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <% })%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="rechazados" href="#tablaProveedoresRechazados"><b>Proveedores Rechazados Por Presentar Errores</b></a> al final de la página.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 5)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div> 
                          Todos los <b>Proveedores</b> fueron <b>Aceptados</b> con éxito.
                          <hr style="height:1px"> 
                          <%cargues.forEach((cargue) => {%>
                            Proveedores Aceptados: <b><%= cargue.aceptados_cargues %></b>
                            <br>Proveedores Rechazados: <%= cargue.rechazados_cargues %>
                            <br>Total: <b><%= cargue.total_cargues %></b>
                          <%})%>
                          <hr style="height:2px"> 
                          Para más información, ver la tabla de <a class="aceptados" href="#tablaProveedores"><b>Productos Grabados en la Base de Datos</b></a>.
                        </div>
                      </div>
                    <%}
                  })%>   
              </div>
            </div>
          </div>

          <div class="card-body">
            <form method="POST" action="/cali/proveedores/cargar/" enctype="multipart/form-data">
              <div class="row">
                <div class="col-md-12">
                  <div>
                    <input class="form-control-lg" id="archivo" type="file" name="archivo" accept=".csv" onchange="return validarExt()" required/> 
                  </div>
                </div>
              </div>   
              <button type="submit" class="btn btn-success pull-right">Subir Archivo</button>
            </form>
          </div>
          
        </div>
      </div>
    </div>
  </div>


  <!-- End Navbar -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header card-header-success">
            <h4 class="card-title"><b>Ingresar proveedor de forma individual</b></h4>
            <p class="card-category">Complete la información del proveedor</p>
          </div>

          <div class="container-fluid">
            <div class="row">
              <div class="col-md-12">
                
                  <%notificaciones.forEach((notificacion) => {
                    if (notificacion.error_notificaciones == 1)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          No se puede crear el Proveedor porque el NIT del proveedor ya esta registrado en la base de datos, para más información ver la tabla de <a class="rechazados" href="#tablaProveedoresRechazados"><b>Proveedores Rechazados Por Presentar Error</b></a> al final de la página.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 2)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          Proveedor creado con éxito, para más información ver la tabla de <a class="aceptados" href="#tablaProveedores"><b>Proveedores Grabados en la Base de Datos</b></a>.
                        </div>
                      </div>
                    <%}
                  })%>
                
              </div>
            </div>
          </div>  

          <div class="card-body">
            <form action="/cali/proveedores" method="POST">
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">NIT del Proveedor</label>
                    <input type="number" class="form-control bg-transparent text-white border-0" name="txtNIT" id="txtNIT" maxlength="50" min="1" pattern="[0-9]+" required>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="bmd-label-floating">Nombre del Proveedor</label>
                    <input type="text" class="form-control bg-transparent text-white border-0" name="txtNombre" id="txtNombre" maxlength="50" required>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Ciudad</label>
                    <input type="text" class="form-control bg-transparent text-white border-0" name="txtCiudad" id="txtCiudad" maxlength="50" required>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="bmd-label-floating">Direccion</label>
                    <input type="text" class="form-control bg-transparent text-white border-0" name="txtDireccion" id="txtDireccion" maxlength="50" required>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="bmd-label-floating">Telefono</label>
                    <input type="number" class="form-control bg-transparent text-white border-0" name="txtTelefono" id="txtTelefono" maxlength="50" min="0" pattern="[0-9]+" required>
                  </div>
                </div>
              </div> 
              <button type="submit" class="btn btn-success pull-right">Crear Proveedor</button>
            </form>
          </div>

        </div>
      </div>
    </div>
  </div>

  <%if (proveedores.length != 0)
  {%>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="card">

            <div class="card-header card-header-success">
              <h4 class="card-title"><b>Proveedores registrados en la base de datos</b></h4>
            </div>

            <div class="container-fluid">
              <div class="row">
                <div class="col-md-12">
                  
                  <%notificaciones.forEach((notificacion) => {
                    if (notificacion.error_notificaciones == 6)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Proveedor modificado con éxito.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 7)
                    {%>
                      <br>
                      <div class="alert alert-danger d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:"><use xlink:href="#exclamation-triangle-fill"/></svg>
                        <div>
                          No se puede eliminar el Proveedor porque ya tiene productos registrados en la base de datos.
                        </div>
                      </div>
                    <%}
                    if (notificacion.error_notificaciones == 8)
                    {%>
                      <br>
                      <div class="alert alert-success d-flex align-items-center" role="alert">
                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Success:"><use xlink:href="#check-circle-fill"/></svg>
                        <div>
                          Proveedor eliminado con éxito.
                        </div>
                      </div>
                    <%}
                  })%>

                </div>
              </div>
            </div>

            <div class="card-body">
              <div class="table-responsive">
                <table class="table mdl-data-table" id="tablaProveedores" style="text-align: center; width:100%;">
                  <thead class=" text-primary">
                    <th>
                      NIT del Proveedor
                    </th>
                    <th>
                      Nombre
                    </th>
                    <th>
                      Ciudad
                    </th>
                    <th>
                      Direccion
                    </th>
                    <th>
                      Telefono
                    </th>
                    <th>
                      Acciones
                    </th>
                  </thead>
                  <tbody>
                    <%proveedores.forEach((proveedor) => {%>
                      <tr>
                        <td class="text-primary"><%=proveedor.nit_proveedores%></td>
                        <td><%=proveedor.nombre_proveedores%></td>
                        <td><%=proveedor.ciudad_proveedores%></td>
                        <td><%=proveedor.direccion_proveedores%></td>
                        <td><%=proveedor.telefono_proveedores%></td>
                        <td>
                          <button type="button" class="btn btnEditarProveedor " data-bs-toggle="modal" data-bs-target="#modalProveedor">
                            EDITAR
                          </button>
                          <button type="submit" class="btn" onclick="confirmarProveedor(<%=proveedor.nit_proveedores%>)"><i class="material-icons">delete_forever</i></button> 
                        </td>
                      </tr>
                    <%})%>
                  </tbody>
                </table>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  <%}%>

  <%if (proveedoresRechazados.length != 0)
  {%>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header card-header-success">
              <h4 class="card-title"><b>Proveedores rechazados por presentar errores</b></h4>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table mdl-data-table" id="tablaProveedoresRechazados" style="text-align: center; width:100%;">
                  <thead class=" text-primary">
                    <th>
                      NIT
                    </th>
                    <th>
                      Nombre
                    </th>
                    <th>
                      Error Registrado
                    </th>
                    <th>
                      Fecha
                    </th>
                  </thead>
                  <tbody>
                    <%proveedoresRechazados.forEach((proveedorRechazado) => {%>
                    <tr>
                      <td class="text-primary"><%=proveedorRechazado.nitproveedor_proveedores_rechazados%></td>
                      <td><%=proveedorRechazado.nombre_proveedores_rechazados%></td>
                      <td class="text-warning"><%=proveedorRechazado.error_proveedores_rechazados%></td>
                      <td><%=proveedorRechazado.fecha_proveedores_rechazados%></td>
                    </tr>
                    <%})%>
                  </tbody>
                  <tr> 
                    <td colspan="4">
                      <a href='/cali/proveedores/limpiar' class="w-100 btn btn-success pull-right"> Limpiar Datos</a>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <%}%>
      
  <div id="modalProveedor" class="modal fade" tabindex="-1" aria-labelledby="modalProveedor" aria-hiden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title" id="exampleModalLabel">Editar Proveedor</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="form" action="/cali/proveedores/modificar/" method="POST">
            <input type="number" name="txtNIT_editar" id="txtNIT_editar" hidden>
            <div class="mb-3">
              <label class="form-label" for="txtNombre_editar">Nombre Proveedor </label>
              <input class="form-control bg-transparent text-black border-0" type="text" name="txtNombre_editar" id="txtNombre_editar" maxlength="50" required>
            </div>
              
            <div class="mb-3">
              <label class="form-label" for="txtCiudad_editar">Ciudad </label>
              <input class="form-control bg-transparent text-black border-0" type="text" name="txtCiudad_editar" id="txtCiudad_editar"	maxlength="50" required>
            </div>
        
            <div class="mb-3">
              <label class="form-label" for="txtDireccion_editar">Dirección </label>
              <input class="form-control bg-transparent text-black border-0" type="text" name="txtDireccion_editar" id="txtDireccion_editar" maxlength="50" required>
            </div> 
    
            <div class="mb-3">
              <label class="form-label" for="txtTelefono_editar">Teléfono</label> 
              <input class="form-control bg-transparent text-black border-0" type="number" name="txtTelefono_editar" id="txtTelefono_editar" maxlength="20" min="1" pattern="[0-9]+" required>
            </div>
          
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Modificar</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
      